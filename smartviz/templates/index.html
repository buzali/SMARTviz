<!DOCTYPE html>
<html lang="en" ng-app="StarterApp">
	<head>
		<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/angular_material/0.8.2/angular-material.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
	</head>
	<body ng-controller="AppCtrl" layout="column">
		{% verbatim %}
		<section layout="row" flex>
	    <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="true">
	      <md-toolbar class="md-theme-indigo" style="min-height:100px;">
	        <h1 class="md-toolbar-tools" style="height:100px;max-height: 100px;">
		        
		        <md-content md-theme="docs-dark" class="" layout="column" layout-sm="column" style="font-size:1em">
			    <md-input-container style="padding: 2px 2px 8px;">
			      <label>City</label>
			      <input type="text" ng-autocomplete ng-model="result" details="details" options="options" placeholder=""/>
			    </md-input-container>
			  </md-content>
		        
	        </h1>
	      </md-toolbar>
	      <md-content ng-controller="LeftCtrl">
	        
			<div layout="column" flex layout-fill>
			  <md-content>
			  <section ng-repeat="feed in events">
			  	<md-subheader class="md-primary md-padding">{{feed.name}}</md-subheader>
			    <md-list>
			      <md-item ng-repeat="item in feed.data">
			      	<md-button>
			        <md-item-content>
			          <!--<div class="md-tile-left">
				          <div class="image" ng-style="{'background-image':'url('+item.titleImage+')'}"></div>
			          </div>-->
			          <div class="md-tile-content">
			            <h3><strong>{{item.name}}</strong></h3>
			            <p>{{item.address}}</p>
			            <!--<p>
			              {{item.description}}
			            </p>-->
			          </div>
			        </md-item-content>
			      </md-button>
			      </md-item>
			    </md-list>
			  </section>
			  </md-content>
			</div>
	      </md-content>
	    </md-sidenav>
	    <md-content flex>
				<ui-gmap-google-map center='map.center' zoom='map.zoom'>
				 <ui-gmap-window show="map.window.show" coords="map.window.model" options="map.window.options" closeclick="map.window.closeClick()">
		            <div>{{map.window.model.name}}</div>
		        </ui-gmap-window>
					<ui-gmap-markers models="mapEvents" coords="'self'" icon="'icon'" events="map.markersEvents">
					</ui-gmap-markers>
				</ui-gmap-google-map>
		</md-content>
		</section>
		{% endverbatim %}
		
		<!-- Angular Material Dependencies -->
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.6/angular.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.6/angular-animate.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-aria.min.js"></script>
		<script src="../static/lodash.min.js"></script>
		<script src="../static/angular-google-maps.min.js"></script>
		<script src="../static/ngAutocomplete.js"></script>
		
		<script src="//ajax.googleapis.com/ajax/libs/angular_material/0.8.2/angular-material.min.js"></script>
    
    
    	<script>
			angular.module('StarterApp', ['uiGmapgoogle-maps','ngMaterial','ngAutocomplete'])
			.controller('AppCtrl', function($scope, $timeout, $mdSidenav, $log, $http) {
			  $scope.map = {
				  center: {
					  latitude: 37.09024,
					  longitude: -95.712891
				  },
				  markers: [], 
				  zoom: 4,
				  markersEvents: {
		            click: function(marker, eventName, model, arguments) {
		                $scope.map.window.model = model;
		                $scope.map.window.show = true;
		            }
		        },
		        window: {
		            marker: {},
		            show: false,
		            closeClick: function() {
		                this.show = false;
		            },
		            options: {pixelOffset: new google.maps.Size(0, -40)} 
		        }
			  };
			  $scope.events = [];
			  $scope.mapEvents = [];
			  $scope.city = "New York";
			  
			  $scope.result = '';
			  $scope.options = {
			      types: '(cities)'
			  };    
    		  $scope.details = '';
			  
	          $(".angular-google-map-container").height($(window).height());
		        
			    /*var httpRequest = $http({
		            method: 'GET',
		            url: '/related/twitter/soup%20kitchen',
		
		        }).success(function(data, status) {
		            $scope.twitter = data;
		        });*/
		        
		        $scope.$watch("details", function(newValue, oldValue) {
				    if (newValue) {
						$scope.events = [];
					    
					    var lng = newValue.geometry.location.D;
					    var lat = newValue.geometry.location.k;
					    
						$scope.map.center = { latitude: lat, longitude: lng };
						$scope.map.zoom = 10;
			        
					    var httpRequest = $http({
				            method: 'GET',
				            url: '/events/foursquare/'+lat+','+lng,
				
				        }).success(function(data, status) {
					        for (i = 0; i < data.length; i++) { 
							    data[i].id = i + 1000;
							}
							if (data.length > 0) {
								$scope.mapEvents = $scope.mapEvents.concat(data);
					            $scope.events.push({name: "Foursquare", data: data});
				            }
				        });
			        
					    var httpRequest = $http({
				            method: 'GET',
				            url: '/events/meetups/'+lat+','+lng,
				
				        }).success(function(data, status) {
					        for (i = 0; i < data.length; i++) { 
							    data[i].id = i + 2000;
							}
							if (data.length > 0) {
								$scope.mapEvents = $scope.mapEvents.concat(data);
					            $scope.events.push({name: "Meetups", data: data});
					        }
				        });
			        
					    var httpRequest = $http({
				            method: 'GET',
				            url: '/events/songkick/'+lat+','+lng,
				
				        }).success(function(data, status) {
					        for (i = 0; i < data.length; i++) { 
							    data[i].id = i + 3000;
							}
							if (data.length > 0) {
								$scope.mapEvents = $scope.mapEvents.concat(data);
					            $scope.events.push({name: "Songkick", data: data});
				            }
				        });
			        }
				});
		        
			})
			.controller('LeftCtrl', function($scope, $timeout, $mdSidenav, $log) {
			  $scope.close = function() {
			    $mdSidenav('left').close()
			                      .then(function(){
			                        $log.debug("close LEFT is done");
			                      });
			  };
			});
			
		</script>
		<style>
		
			.md-tile-left div.image {
				border-radius: 30px;
				border: 1px solid #ddd;
				width: 48px;
				height:48px;
				background-size:cover;
				margin: 16px; }
			.angular-google-map-container { height: 100px; width:100%; }
			md-input-container.md-docs-dark-theme .md-input {
				color: rgba(255,255,255,1.0);
				border-color: rgba(255,255,255,0.12);
			}
			
			md-item .md-button {
				text-align: left;
				width:100%;
				white-space: normal;
				padding:0;
				text-transform: none;
				font-weight: inherit;
				
			}
			
			input::-webkit-input-placeholder { color:transparent; }
			input::-moz-placeholder { color:transparent; } /* FF 4-18 */
			input::-moz-placeholder { color:transparent; } /* FF 19+ */
			input::-ms-input-placeholder { color:transparent; } /* IE 10+ */
							
		</style>
	</body>
</html>